<!DOCTYPE html>
<!--
   Copyright 2014 Spotify AB
   Copyright 2016 MP Objects BV

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
-->
<html lang="en">
  <head>
    <title>Online Java Thread Dump Analyzer</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="stylesheet.css"/>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <script src="https://code.jquery.com/jquery-1.12.4.min.js" type="text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js"></script>
    <style>
    ul.nav li > span.glyphicon-remove {
      display: none;
      position: absolute;
      cursor: pointer;
      right: 5px;
      top: 4px;
      color: #bbb;
    }
    
    ul.nav li:hover > span.glyphicon-remove {
      display: inline-block;
    }
    
    ul.nav li:hover > span.glyphicon-remove:hover {
      color: #d00;
    }
    </style>
    <script type="text/javascript">
    var dumpCounter = 0;
    var dumpAnalysis = {};
    
    function addDump() {
      ++dumpCounter;
      var model = {
        id: 'tda_'+dumpCounter,
        name: 'Dump #'+dumpCounter
      };
      $('#adddump').parent().before(Mustache.render($('#tmpl-tab').html(), model));
      $('#dumptabs>li[data-dumpid='+model.id+']>span').click(removeDump);
      $('#dumps').append(Mustache.render($('#tmpl-tab-panel').html(), model));
      $('#dumps>div[data-dumpid='+model.id+'] form button').click(function() { executeAnalysis(model.id); });
      $('#dumptabs>li[data-dumpid='+model.id+']>a').tab('show');
    }
    
    function removeDump() {
      var dumpId = $(this).parent('li').attr('data-dumpid');
      var tab = $('#dumptabs>li[data-dumpid='+dumpId+']');
      if (tab.hasClass('active')) {
        if (tab.prev('li[data-dumpid]').size() > 0) {
          tab.prev('li[data-dumpid]').children('a').tab('show');
        } else {
          tab.next('li[data-dumpid]').children('a').tab('show');
        }
      }
      tab.remove();
      $('#dumps>div[data-dumpid='+dumpId+']').remove();
      delete dumpAnalysis[dumpId];
      return false;
    }
    
    function executeAnalysis(dumpId) {
      alert(dumpId);
    }
    
    $(document).ready(function(){
      $('#adddump').click(addDump);
      // create the first dump
      addDump();
    });
    </script>
  </head>
  <body>
    <div class="alert alert-info alert-dismissible">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      This page is client-side only. No data will leave your computer when you click Analyze.
    </div>

    <ul id="dumptabs" class="nav nav-tabs">
      <li><a class="btn" id="adddump"><span class="glyphicon glyphicon-plus"></span></a></li>
      <li><a class="btn" href="#about" data-toggle="tab"><span class="glyphicon glyphicon-info-sign"></span></a></li>
    </ul>
    
    <div id="dumps" class="tab-content">
      <p></p>
      <div id="about" class="tab-pane container">
        <div class="jumbotron">
        <h1>Java Thread Dump Analyzer</h1>
        <p><a href="http://github.com/mpobjects/threaddump-analyzer">Source code on Github</a></p>
        </div>
        
        <div>
          <h2>License</h2>
          <p>The Java Thread Dump Analyzer is licensed under version <a href="http://www.apache.org/licenses/LICENSE-2.0.html">2.0 of the Apache license</a>.</p>
          <p>Copyright 2014 Spotify AB</p>
          <p>Copyright 2016 MP Objects BV</p>
        </div>
      </div>
    </div>

    <script id="tmpl-tab" type="x-tmpl-mustache">
    <li data-dumpid="{{id}}">
      <a href="#dump_{{id}}" data-toggle="tab">{{name}}</a>
      <span class="glyphicon glyphicon-remove"></span>
    </li>
    </script>
    
    <script id="tmpl-tab-panel" type="x-tmpl-mustache">
    <div id="dump_{{id}}" class="tab-pane" data-dumpid="{{id}}">
      <div id="input_{{id}}" class="container-fluid">
        <h1>Analysis for {{name}}</h1>
        <form>
          <div class="form-group">
            <label for="dumpInput_{{id}}">Thread Dump</label>
            <textarea class="form-control" id="dumpInput_{{id}}" rows="5" placeholder="Paste your thread dump here"></textarea>
          </div>
          <button type="button" class="btn btn-primary">Analyze</button>
        </form>
      </div>
      
      <nav id="navbar_{{id}}" class="navbar navbar-default navbar-fixed-bottom">
        <div class="container-fluid">
          <ul class="nav navbar-nav">
            <li id="nav_input_{{id}}"><a href="#input_{{id}}">Input</a></li>
            <li id="nav_methods_{{id}}"><a href="#methods_{{id}}">Top Running Methods <span class="label label-default"></span></a></li>
            <li id="nav_threads_{{id}}"><a href="#threads_{{id}}">Thread Overview <span class="label label-default"></span></a></li>
            <li id="nav_synchronizers_{{id}}"><a href="#synchronizers_{{id}}">Synchronizers <span class="label label-default"></span></a></li>
            <li id="nav_garbage_{{id}}"><a href="#garbage_{{id}}">Ignored Lines</a></li>
          </ul>
        </div>
      </nav>
    </div>
    </script>

  </body>
</html>
